<!-- ========================  MAP FROM MAPBOX -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.23.0/mapbox-gl.js'></script>
 <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>

<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.23.0/mapbox-gl.css' rel='stylesheet' />

 <!-- /*<style>
     body { margin:0; padding:0; }
     #map { position:absolute; top:0; bottom:0; width:100%; opacity: 0.4; transition: 1s;}
 </style>*/ -->

 <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v2.2.0/mapbox-gl-directions.js'></script>
 <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v2.2.0/mapbox-gl-directions.css' type='text/css' />






<!-- .........................   MAP on the page-->
 <div id='map'></div>
<!-- .........................   MAP on the page-->





<!-- ========================  MAP FROM MAPBOX  script-->
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibWFnZGFsZW5hYmlhbG9uIiwiYSI6ImNpc2p3cnUwczAycXcyem9jYXpzZWZ6eW4ifQ.RWDUb9U9vdUlNuKcPGJDhg';

   var map = new mapboxgl.Map({
       container: 'map',
      //  style: 'mapbox://styles/mapbox/streets-v9',
       style: 'mapbox://styles/mapbox/dark-v9',
       center: [144.958998, -37.818535],
       zoom: 13
   });


   map.addControl(new mapboxgl.Directions());


   var directions = new mapboxgl.Directions({
     unit: 'metric', // Use the metric system to display distances.
     profile: 'driving', // Set the initial profile to walking.
     container: 'directions', // Specify an element thats not the map container.
     proximity: [144.96, -37.82] // Give search results closer to these coordinates higher priority.
   });





// ===========================  parking locations

  map.on('load', function() {

    $.ajax({
      url: "https://data.melbourne.vic.gov.au/resource/9xmh-yeh2.json",
      type: "GET",
      data: {
        "$limit" : 1000,
        "$$app_token" : "q0QvItQ7Te62kF5Yr2ebfoeNs"
      }
    }).done(function(data) {


        var geojson = {
          type: 'FeatureCollection',
          features: []
        };

        data.forEach(function(e) {
          geojson.features.push({
            type: 'Feature',
            properties: {
              "parking_type": e.parking_type,
              "number_of_spaces": e.parking_spaces,
              "iconSize": [20, 20]
            },
            geometry: {
              "type": "Point",
              "coordinates": [
                e.x_coordinate.coordinates[0],
                e.x_coordinate.coordinates[1],
              ]
            }
          });
        // console.log(e.x_coordinate.coordinates)
        });

        geojson.features.forEach(function(marker) {

            // create a DOM element for the marker
            var el = document.createElement('div');

            el.className = 'marker';
            el.style.backgroundImage = 'url(https://placekitten.com/g/' + marker.properties.iconSize.join('/') + '/)';
            el.style.width = marker.properties.iconSize[0] + 'px';
            el.style.height = marker.properties.iconSize[1] + 'px';

            el.addEventListener('click', function() {
                window.alert(marker.properties.parking_type);
                window.alert(marker.properties.number_of_spaces);
            });

          // add marker to map
          new mapboxgl.Marker(el, {offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2]})
              .setLngLat(marker.geometry.coordinates)
              .addTo(map);
      });
    })
// ===========================  parking location




// ===========================  autolocation
     navigator.geolocation.getCurrentPosition(function(geo) {
      // console.log(geo)
      $('#map').css({
        'opacity': '1'
      });
      $('#mapbox-directions-origin-input , #mapbox-directions-destination-input, .mapbox-form-label, .js-reverse-inputs').css({
        'display': 'none'
      });
      // $('.mapbox-directions-component mapbox-directions-inputs').hide();
       directions.setOrigin([ geo.coords.longitude, geo.coords.latitude ]);
       directions.setDestination([144.95842859999993, -37.81884560000003]);    // On load, set the origin to GA Melbourne

     });
  });



// ===========================  directions
   directions.on('route', function(e) {
     console.log(e.route); // Logs the current route shown in the interface.
   map.setZoom(17);
   map.scrollZoom.disable();
   });


   map.addControl(new mapboxgl.Navigation());


</script>
<!-- ========================  MAP FROM MAPBOX  script-->







<!-- ========================  WEATHER  -->
<!-- <div class = "weather">
  <div id="cont_21d71ee597e69cbb9fd0e2e85960b55e"></div>
</div>
<script type="text/javascript" async src="https://www.theweather.com/wid_loader/21d71ee597e69cbb9fd0e2e85960b55e"></script> -->
<!-- ========================  WEATHER  -->





<!-- ========================  PARKING MAP  -->
<!-- <div><iframe width="760px" title="wdi_conf" height="646px" src="https://data.melbourne.vic.gov.au/w/m4j7-darc/spy9-nmud?cur=jBdT_JGn9RO&from=root" frameborder="0"scrolling="no"><a href="https://data.melbourne.vic.gov.au/Property-Planning/wdi_conf/m4j7-darc" title="wdi_conf" target="_blank">wdi_conf</a></iframe></div> -->
<!-- ========================  PARKING MAP  -->

<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-_tjRXvZwDBMsFKx2He46Jv3MBw-_oT0"
        async defer></script> -->
